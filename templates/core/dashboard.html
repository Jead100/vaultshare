{% extends "base.html" %}
{% load static %}

{% block title %} | Dashboard {% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 sm:px-6">
    <h1 class="text-2xl sm:text-3xl font-bold mb-6 text-gray-800">Your Dashboard</h1>

    <!-- Upload section -->
    <div class="bg-white p-4 sm:p-6 rounded-2xl shadow-lg border border-gray-100 mb-8">
        <h2 class="text-xl sm:text-2xl font-semibold mb-4 text-gray-800">Upload a File</h2>

        <form 
            action="{% url 'core:dashboard' %}" method="post" id="upload-form" 
            enctype="multipart/form-data" class="space-y-4">
            {% csrf_token %}
            
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 md:gap-4">
                <!-- File picker + filename -->
                <div class="flex flex-1 items-center gap-3 min-w-0">
                    <div id="file-picker-group" class="w-full md:w-auto">
                        <!-- Hidden native input -->
                        <input type="file" name="file" id="file-input" class="hidden">

                        <!-- Visible trigger that opens the file picker -->
                        <label
                            id="file-label" 
                            for="file-input" 
                            class="bg-gray-100 px-4 py-2 rounded-lg border border-gray-300 
                                    cursor-pointer hover:bg-gray-200 transition inline-block
                                    w-full md:w-auto text-center md:text-left"
                        >
                            Select a file
                        </label>
                    </div>
                    
                    <div id="filename-group" class="hidden flex md:inline-flex justify-center w-full md:w-auto">
                        <span id="file-name"
                            class="text-sm text-gray-600 ml-2 truncate max-w-[16rem]"
                        >
                            No file selected
                        </span>

                        <!-- Clear selection (hidden until a file is chosen) -->
                        <button
                            type="button" id="clear-file"
                            class="hidden text-red-500 hover:text-red-700 px-2"
                            aria-label="Clear selected file" title="Clear"
                        >
                            &times;
                        </button>
                    </div>
                </div>

                <!-- Upload button (disabled until a file is chosen) -->
                <button 
                    type="submit" id="upload-btn"
                    class="w-full md:w-auto md:ml-auto bg-blue-500 text-white px-4 py-2 rounded-lg
                         hover:bg-blue-600 transition disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled
                >
                    Upload
                </button>
            </div>
  
            <div id="upload-errors" class="text-red-500 text-sm" role="status" aria-live="polite"></div>
        </form>
    </div>

    <!-- Files list section -->
    <div id="files-list" class="bg-white p-4 sm:p-6 rounded-2xl shadow-lg border border-gray-100">
        <div class="flex items-center justify-between gap-3 flex-wrap mb-4">
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-800">Your Files</h2>
        </div>

        <div class="overflow-x-auto -mx-4 sm:mx-0">
            <div id="files-list-body" class="min-w-full px-4 sm:px-0">
                {% include "_partials/_files_list.html" with files=files %}
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block modals %}
    {% include "_partials/_confirm_modal.html" %}
{% endblock %}

{% block scripts %}
    <script src="{% static 'js/ui/confirm-modal.js' %}" defer></script>
    <script src="{% static 'js/pages/dashboard.js' %}" defer></script>
{% endblock %}
